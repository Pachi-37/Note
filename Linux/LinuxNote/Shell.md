# Shell

### 什么是Shell

- Shell是命令解释器，解释用户对系统的操作

Shell查看

`cat /etc/shells`

默认的Shell为`bash`



### Linux启动过程(大量Shell脚本)

1. BIOS
   - 
2. MBR
   - `dd if=/dev/sda if=mbr.bin bs=446 count=1`
     - 446：主引导记录
     - 512：+ 分区表
   - `hexdump -C mbr.bin`
     - 16进制查看
3. Grub
   - `/boot/grub2`
   - `grub2-editenv list`
     - 显示默认引导的内核
   - `uname -r`
     - 当前使用内核
4. Kernel
5. systemd
   - `/etc/systemd/system`
   - `/usr/lib/systemd/system`
6. init
   - `/etc/rc.d`
7. shell



Shell脚本：组合命令和多次执行，使用脚本文件来保存需要执行的命令



### 包含元素

- `Sha-Bang`

  - ```bash
    #!/bin/bash
    ```

    

- 命令

- 注释

- 权限

  - 赋予文件权限
    - 二进制只需要执行
    - 其他文件还需要读

- 执行命令

  - 产生新的进程
    - `bash ./filename.sh`
      - 可以不用改变权限
    - `./filename.sh`
      - 必须有可执行权限
  - `source ./filename.sh`
  - `. ./filename.sh`

- 内建命令与外部命令
  - 内建命令不需要创建子进程
  - 内建命令对当前`Shell`生效



### 管道 & 重定向

##### 管道

- 进程通讯主要的通讯工具之一
- 匿名管道（管道符`|`）Shell 脚本常用的工具
  1. 将第一个命令的输出作为第二个命令输入
  2. 可以给两个外部命令创建子进程[^1]
     - 因为该进程为子进程，使用内部命令父进程是显示不了结果的

##### 重定向

- 输出文件/文件代替键盘输入
- 输入重定向`<`
- 输出重定向`>` `>>` `2>` `&>`  
  - 覆盖
  - 追加
  - 错误重定向
    - 正确 & 错误



### 变量

- 命名
  - 字母数字下划线——不使用数字开头
- 赋值
  - 变量名=变量值
    - a = 123
  - 使用`let`
    - let a = 123
  - 将命令赋值给变量
    - l = ls
  - 将命令结果赋值给变量，使用`$()`或者``` `
    - b = $(ls -l)
  - 变量中有特殊字符可以包含在`""`或者`''`

- 引用
  - `${变量名}`
- 查看变量值
  - `echo ${变量名}`
- 部分情况下省略写法
  - `$变量名`

##### 变量作用范围

- 导出
  - `export`
- 删除
  - `unset`

- 变量在子进程不生效，如果使用脚本想要是变量生效
  - `source a.sh`



##### 系统环境变量

使得每个`Shell`打开都可以获得变量

- 环境变量
  - `set`   `env`
    - 预定义变量
    - `$?`
      - 上一条命令是否正确执行	
    - `$$`
      - PID
    - `$0`
      - 当前进程名称
  - `$?`  `$$`  `$0`
  - `$PATH`
  - `$PS1`
- 位置变量
  - `$1`  `$2`   `$n` 
  - 参数替换
    - `a=${1-_}`



##### 数组

- 定义数组
  - `IPTS=(10.0.0.1 10.0.0.2 10.0.0.3)`
- 显示数组的所有元素
  - `echo ${IPTS[@]}`
- 显示数组元素个数
  - `echo ${#IPTS[@]}`
- 显示数组第一个元素
  - `echo ${#IPTS[0]}`



##### 特殊字符

字面意思

元意

- `#`
  - 注释
- `;`
  - 分号
- `\`
  - 转义符号
- `'  "  `
  - 引号



##### 转义

- 单个字母转义
  - `\n`  `\t`  `\r`
- 非单个字母转义
  - `\\ `  `\$`   `\'`



##### 引用

- `"`
  - 不完全引用，解释
- `'`
- \`



##### 运算符

- 赋值运算符
  - `=`
- 取消赋值
  - `unset`
- `=`还可以作为测试运算符

- 算数运算符
  - `+`  `-`  `*`  `/`  `**`  `%`
- 使用`expr`运算(只支持整数)
  - `expr 4 + 5`
- 数值常量赋值
  - `let "变量名=变量值"`
    - 变量值
      - 0开头八进制
      - 0X开头十六进制



##### 双圆括号

双圆括号是`let`命令的简写

- `((a=10))`
- `((a++))`



### 特殊符号

- 引号
  - `'`
    - 完全引用
  - `"`
    - 不完全引用
  -  `
    - 执行命令
- 括号
  - 圆括号
    - `()`
      - 产生子`Shell`
        - ( a=1 )
        - 父`shell`无法查看值
      - 数组初始化
        - `a=(a1, a2, a3)`
    - `(())`——`let`
      - 数值操作
      - `(( 1+1))`
    - `$()`
      - 命令
      - `$(ls)`
  - 方括号
    - `[]`——`test`
      - 单独使用测试   数组元素
      - `[ 5 -gt 4]` `echo $?`
    - `[[]]`
      - 测试表达式
      - `[[ 5 < 4 ]]`  `echo $?`
  - 尖括号
    - `<>`
      - 重定向
  - 花括号
    - `{}`
      - 输出范围 
        - `echo {0..9}`
      - 文件复制
        - `cp -v /etc/passwd /etc/passwd.bak`
        - `cp -v /etc/passwd{,.bak}`
- 运算和逻辑符号
- 转义符号
- 其他符号
  - `#`
    - 注释
  - `;`
    - 命令分隔符
    - `case`语句分隔符要转义`;;`
  - ` :` 
    - 空指令
  - `.`——`source`
  - `~`
    - 家目录
  - `,`
    - 分隔目录
  - `*`
    - 通配符
  - `?`
    - 条件测试 / 通配符
  - `$`
    - 取值符号
  - `|`
    - 管道符
  - `&`
    - 后台运行
  - `_`
    - 空格

### 测试

退出命令

- `exit`
  - `exit 10` 返回10给`Shell`,返回值非零不正常退出
- `$?`
  - 判断当前`Shell`前一个进程是否正常退出

测试命令

- `test`命令用于检查文件或者比较值
  - 文件测试
  - 整数比较测试
  - 字符串测试
- `test`语句可以简化为`[]`
- 支持扩展写法`[[]]`
  - `&&`
  - `||`
  - `<`
  - `>`
- `if-then`
  - `if [条件成立] 或 命令返回值是否为0`
  - `then 命令`
  - `fi结束`



##### 环境变量配置文件

`/etc/profile`

`/etc/profile.d`

`~/.bash_profile`

`~/.bashrc`

`/etc/bashrc`



 

[^1]:查看进程信息`/proc/[process_id]/fd` `0` ：标准输入[^2]`1`：标准输出[^3] `2`错误输出
[^2]:`/dev/pts/0`图形界面 `/dev/pty`字符终端 
[^3]:指向一个管道，匿名管道，管道符







